{"version":3,"sources":["Global.js"],"names":["cc","Class","extends","Component","properties","onLoad","log","window","th","initManager","urlParse","node","getContentSize","width","height","wsurl","myself","account_id","nickname","headimgurl","account_ticket","phone","isPlayer","needLookCount","token","sign","gametype","room","room_id","room_number","players","guests","max_count","seatxy","getNiuIndex","cardType","comboPoint","Number","index","getSeatXY","toString","getGuestById","find","guest","getPlayerById","player","getLocalIndex","total","rindex","getMyselfSeatIndex","getSeatIndexById","serial_num","getMyselfPlayer","getMyselfLocalIndex","getBankerPlayer","is_banker","initRoom","banker_mode","clear","room_status","forEach","account_status","banker_multiples","multiples","cards","card_type","combo_array","combo_point","ws","require","AudioManager","audioManager","init","playBGM","WebSocketManager","webSocketManager","initHandlers","params","code","location","name","value","href","num","indexOf","paramsStr","substr","arr","split","i","length","substring","args"],"mappings":"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","file":"Global.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {},\r\n\r\n    onLoad: function() {\r\n        cc.log(\"Global onLoad....................\");\r\n        window.th = window.th || {};\r\n\r\n        this.initManager();\r\n        this.urlParse();\r\n\r\n        const { width, height } = this.node.getContentSize();\r\n        th.wsurl = \"ws://47.96.177.207:10000/api\"; //websocket连接地址\r\n        th.width = width; //宽度\r\n        th.height = height; //高度\r\n        th.myself = {\r\n            account_id: \"000000\",\r\n            nickname: \"游客\", //名字\r\n            headimgurl: \"\", //头像\r\n            account_ticket: 0, //房卡\r\n            phone: \"--------\",\r\n            isPlayer: false, //是不是玩家（不是玩家就是游客）， false=游客\r\n            needLookCount: 0 //只用为0才能点击摊牌  会在收到 ShowCard 设置\r\n        };\r\n        th.token = null;\r\n        th.sign = null;\r\n        th.gametype = null; //游戏类型 nn,zjh\r\n        th.room = {\r\n            room_id: null,\r\n            room_number: null,\r\n            players: [], //游戏人员列表\r\n            guests: [], //观战人员列表\r\n            max_count: 0 //总人数\r\n        };\r\n        //座位坐标\r\n        th.seatxy = {\r\n            \"6\": [\r\n                [-305, -420],\r\n                [305, -100],\r\n                [305, 200],\r\n                [-100, 485],\r\n                [-305, 200],\r\n                [-305, -100]\r\n            ],\r\n            \"9\": [\r\n                [-305, -420],\r\n                [305, -200],\r\n                [305, 0],\r\n                [305, 200],\r\n                [305, 400],\r\n                [-305, 400],\r\n                [-305, 200],\r\n                [-305, 0],\r\n                [-305, -200]\r\n            ],\r\n            \"10\": [\r\n                [-305, -420],\r\n                [305, -220],\r\n                [305, -40],\r\n                [305, 140],\r\n                [305, 320],\r\n                [-100, 485],\r\n                [-305, 320],\r\n                [-305, 140],\r\n                [-305, -40],\r\n                [-305, -220]\r\n            ],\r\n            \"12\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [-100, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ],\r\n            \"13\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [305, 485],\r\n                [-305, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ]\r\n        };\r\n        th.getNiuIndex = function(cardType, comboPoint) {\r\n            cardType = Number(cardType);\r\n            let index = 0;\r\n            if (cardType == 1) {\r\n                index = 0;\r\n            } else if (cardType >= 4 && cardType <= 14) {\r\n                index = cardType + 6;\r\n            } else {\r\n                index = comboPoint;\r\n            }\r\n            return index;\r\n        };\r\n        th.getSeatXY = function() {\r\n            return th.seatxy[this.room.max_count.toString()];\r\n        };\r\n        th.getGuestById = function(account_id) {\r\n            return this.room.guests.find(\r\n                guest => guest.account_id == account_id\r\n            );\r\n        };\r\n        th.getPlayerById = function(account_id) {\r\n            return this.room.players.find(\r\n                player => player.account_id == account_id\r\n            );\r\n        };\r\n        th.getLocalIndex = function(index) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let total = Number(th.room.max_count);\r\n            let rindex =\r\n                (Number(index) - th.getMyselfSeatIndex() + total) % total;\r\n            return rindex;\r\n        };\r\n        th.getSeatIndexById = function(account_id) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getPlayerById(account_id);\r\n            return player.serial_num - 1;\r\n        };\r\n        th.getMyselfSeatIndex = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getPlayerById(th.myself.account_id);\r\n            return Number(player.serial_num) - 1;\r\n        };\r\n        th.getMyselfPlayer = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return null;\r\n            }\r\n            let player = this.getPlayerById(th.myself.account_id);\r\n            return player;\r\n        };\r\n        th.getMyselfLocalIndex = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getMyselfPlayer();\r\n            return this.getLocalIndex(player.serial_num - 1);\r\n        };\r\n        th.getBankerPlayer = function() {\r\n            return this.room.players.find(player => player.is_banker == 1);\r\n        };\r\n        th.initRoom = function() {\r\n            if (th.room.banker_mode == 1) {\r\n                th.myself.needLookCount = 2;\r\n            }\r\n        };\r\n        th.clear = function() {\r\n            th.room.room_status = 1;\r\n            th.room.players.forEach(player => {\r\n                player.account_status = 1;\r\n                player.banker_multiples = \"\";\r\n                player.multiples = 0;\r\n                player.cards = [];\r\n                player.card_type = 0;\r\n                player.combo_array = [];\r\n                player.combo_point = 0;\r\n                player.is_banker = 0;\r\n            });\r\n        };\r\n    },\r\n    initManager() {\r\n        th.ws = require(\"WebSocket\");\r\n\r\n        const AudioManager = require(\"AudioManager\");\r\n        th.audioManager = new AudioManager();\r\n        th.audioManager.init();\r\n\r\n        //播放背景音乐\r\n        th.audioManager.playBGM(\"background.mp3\");\r\n\r\n        const WebSocketManager = require(\"WebSocketManager\");\r\n        th.webSocketManager = new WebSocketManager();\r\n        th.webSocketManager.initHandlers();\r\n    },\r\n    urlParse() {\r\n        let params = { code: 123 };\r\n        if (window.location == null) {\r\n            return params;\r\n        }\r\n        let name, value;\r\n        let location = window.location.href; //取得整个地址栏\r\n        let num = location.indexOf(\"?\");\r\n        let paramsStr = location.substr(num + 1); //取得所有参数   stringvar.substr(start [, length ]\r\n        let arr = paramsStr.split(\"&\"); //各个参数放到数组里\r\n        for (let i = 0; i < arr.length; i++) {\r\n            num = arr[i].indexOf(\"=\");\r\n            if (num > 0) {\r\n                name = arr[i].substring(0, num);\r\n                value = arr[i].substr(num + 1);\r\n                params[name] = value;\r\n            }\r\n        }\r\n        cc.log(\"Params:\", params);\r\n        th.href = location.substr(0, location.indexOf(\"?\"));\r\n        th.args = params;\r\n    }\r\n});\r\n"]}