{"version":3,"sources":["AudioManager.js"],"names":["cc","Class","extends","Component","properties","bgmVolume","sfxVolume","bgmAudioID","sfxAudioID","_pauseBgm","onLoad","log","init","bgm","sys","localStorage","getItem","parseFloat","setItem","sfx","game","on","EVENT_HIDE","audioEngine","pauseAll","EVENT_SHOW","resumeAll","getUrl","url","idx","lastIndexOf","logic","substr","playBGM","audioUrl","stop","loader","loadRes","AudioClip","err","clip","play","playSFX","setSFXVolume","v","setBGMVolume","resume","pause","setVolume"],"mappings":"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","file":"AudioManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bgmVolume: 0.5,\r\n        sfxVolume: 0.5,\r\n        bgmAudioID: -1,\r\n        sfxAudioID: -1,\r\n        _pauseBgm: true\r\n    },\r\n\r\n    onLoad: function() {\r\n        cc.log(\"AudioManager OnLoad.....\");\r\n    },\r\n\r\n    init: function() {\r\n        const bgm = cc.sys.localStorage.getItem(\"bgmVolume\");\r\n        if (bgm) {\r\n            this.bgmVolume = parseFloat(bgm);\r\n        } else {\r\n            cc.sys.localStorage.setItem(\"bgmVolume\", this.bgmVolume);\r\n        }\r\n\r\n        const sfx = cc.sys.localStorage.getItem(\"sfxVolume\");\r\n        if (sfx) {\r\n            this.sfxVolume = parseFloat(sfx);\r\n        } else {\r\n            cc.sys.localStorage.setItem(\"sfxVolume\", this.sfxVolume);\r\n        }\r\n\r\n        cc.game.on(cc.game.EVENT_HIDE, function() {\r\n            cc.log(\"cc.audioEngine.pauseAll\");\r\n            cc.audioEngine.pauseAll();\r\n        });\r\n        cc.game.on(cc.game.EVENT_SHOW, function() {\r\n            cc.log(\"cc.audioEngine.resumeAll\");\r\n            cc.audioEngine.resumeAll();\r\n        });\r\n    },\r\n\r\n    getUrl: function(url) {\r\n        const idx = url.lastIndexOf(\".\");\r\n        const logic = idx > -1 ? url.substr(0, idx) : url;\r\n        return `sounds\\/${logic}`;\r\n    },\r\n\r\n    playBGM(url) {\r\n        const audioUrl = this.getUrl(url);\r\n        if (this.bgmAudioID >= 0) {\r\n            cc.audioEngine.stop(this.bgmAudioID);\r\n        }\r\n        this._pauseBgm = true;\r\n        cc.loader.loadRes(audioUrl, cc.AudioClip, (err, clip) => {\r\n            if (!err) {\r\n                this.bgmAudioID = cc.audioEngine.play(\r\n                    clip,\r\n                    true,\r\n                    this.bgmVolume\r\n                );\r\n            }\r\n        });\r\n    },\r\n\r\n    playSFX(url) {\r\n        const audioUrl = this.getUrl(url);\r\n        /*\r\n        if(this.sfxAudioID>=0){\r\n            cc.audioEngine.stop(this.sfxAudioID);\r\n        }\r\n        */\r\n        if (this.sfxVolume > 0) {\r\n            cc.loader.loadRes(audioUrl, cc.AudioClip, (err, clip) => {\r\n                if (!err) {\r\n                    this.sfxAudioID = cc.audioEngine.play(\r\n                        clip,\r\n                        false,\r\n                        this.sfxVolume\r\n                    );\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    setSFXVolume: function(v) {\r\n        if (this.sfxVolume != v) {\r\n            cc.sys.localStorage.setItem(\"sfxVolume\", v);\r\n            this.sfxVolume = v;\r\n        }\r\n    },\r\n\r\n    setBGMVolume: function(v) {\r\n        if (this.bgmAudioID >= 0) {\r\n            if (this._pauseBgm && v > 0) {\r\n                this._pauseBgm = false;\r\n                cc.audioEngine.resume(this.bgmAudioID);\r\n            } else if (!this._pauseBgm && v == 0) {\r\n                this._pauseBgm = true;\r\n                cc.audioEngine.pause(this.bgmAudioID);\r\n            }\r\n        }\r\n        if (this.bgmVolume != v) {\r\n            cc.sys.localStorage.setItem(\"bgmVolume\", v);\r\n            this.bgmVolume = v;\r\n            cc.audioEngine.setVolume(this.bgmAudioID, v);\r\n        }\r\n    },\r\n\r\n    pauseAll: function() {\r\n        cc.audioEngine.pauseAll();\r\n    },\r\n\r\n    resumeAll: function() {\r\n        cc.audioEngine.resumeAll();\r\n    }\r\n});\r\n"]}