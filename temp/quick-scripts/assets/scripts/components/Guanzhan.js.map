{"version":3,"sources":["Guanzhan.js"],"names":["cc","Class","extends","Component","properties","btnJoin","Button","btnLook","guestPrefab","Prefab","guestsNode","Node","onLoad","th","node","active","show","isPlayer","myself","removeAllChildren","guests","room","forEach","guestItem","instantiate","getChildByName","getComponent","string","guest","nickname","headImg","loader","load","url","headimgurl","type","err","texture","headSpriteFrame","SpriteFrame","Rect","width","height","spriteFrame","setScale","addChild","onCloseClicked","targer","value","audioManager","playSFX","onJoinClicked","log","wc","params","operation","account_id","session","sign","data","room_number","ws","send","JSON","stringify","onLookClicked","onEnable"],"mappings":"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","file":"Guanzhan.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        btnJoin: cc.Button,\r\n        btnLook: cc.Button,\r\n        guestPrefab: cc.Prefab,\r\n        guestsNode: cc.Node\r\n    },\r\n\r\n    onLoad: function() {\r\n        if (th == null) {\r\n            return;\r\n        }\r\n        this.node.active = false;\r\n    },\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    show() {\r\n        this.node.active = true;\r\n        let isPlayer = th.myself.isPlayer;\r\n        this.btnJoin.node.active = !isPlayer;\r\n        this.btnLook.node.active = isPlayer;\r\n        this.guestsNode.removeAllChildren();\r\n        //初始化观战人员\r\n        let guests = th.room.guests;\r\n        guests.forEach(guest => {\r\n            let guestItem = cc.instantiate(this.guestPrefab);\r\n            guestItem\r\n                .getChildByName(\"lbl_name\")\r\n                .getComponent(\"cc.Label\").string = guest.nickname;\r\n\r\n            let headImg = guestItem\r\n                .getChildByName(\"headImg\")\r\n                .getComponent(\"cc.Sprite\");\r\n            cc.loader.load(\r\n                {\r\n                    url: guest.headimgurl,\r\n                    type: \"jpg\"\r\n                },\r\n                (err, texture) => {\r\n                    if (!err) {\r\n                        let headSpriteFrame = new cc.SpriteFrame(\r\n                            texture,\r\n                            cc.Rect(0, 0, texture.width, texture.height)\r\n                        );\r\n                        headImg.spriteFrame = headSpriteFrame;\r\n                        headImg.node.setScale(2 - texture.width / 120);\r\n                    }\r\n                }\r\n            );\r\n            this.guestsNode.addChild(guestItem);\r\n        });\r\n    },\r\n\r\n    onCloseClicked: function(targer, value) {\r\n        th.audioManager.playSFX(\"click.mp3\");\r\n        this.node.active = false;\r\n    },\r\n\r\n    onJoinClicked: function(targer) {\r\n        th.audioManager.playSFX(\"click.mp3\");\r\n        cc.log(\"onJoinClicked\");\r\n        cc.log(\"onJoinClicked\");\r\n        th.wc.show(\"正在加入房间...\");\r\n        const params = {\r\n            operation: \"JoinRoom\", //操作标志\r\n            account_id: th.myself.account_id, //用户id};\r\n            session: th.sign,\r\n            data: {\r\n                room_number: th.room.room_number\r\n            }\r\n        };\r\n        cc.log(\"===>>>[JoinRoom] JoinOrLook:\", params);\r\n        th.ws.send(JSON.stringify(params));\r\n    },\r\n    onLookClicked: function(targer) {\r\n        th.audioManager.playSFX(\"click.mp3\");\r\n        cc.log(\"onLookClicked\");\r\n        th.wc.show(\"正在加入房间...\");\r\n        const params = {\r\n            operation: \"GuestRoom\", //操作标志\r\n            account_id: th.myself.account_id, //用户account_id};\r\n            session: th.sign,\r\n            data: {\r\n                room_number: th.room.room_number\r\n            }\r\n        };\r\n        cc.log(\"===>>>[GuestRoom] JoinOrLook:\", params);\r\n        th.ws.send(JSON.stringify(params));\r\n    },\r\n\r\n    onEnable: function() {}\r\n});\r\n"]}