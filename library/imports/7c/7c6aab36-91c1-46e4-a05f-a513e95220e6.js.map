{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Global.js"],"names":["cc","Class","extends","Component","properties","onLoad","log","window","th","initManager","urlParse","node","getContentSize","width","height","wsurl","myself","account_id","nickname","headimgurl","account_ticket","phone","isPlayer","needLookCount","token","sign","gametype","room","room_id","room_number","players","guests","max_count","copyurl","seatxy","getNiuIndex","cardType","comboPoint","Number","index","getSeatXY","toString","getGuestById","find","guest","getPlayerById","player","getLocalIndex","total","rindex","getMyselfSeatIndex","getSeatIndexById","serial_num","getMyselfPlayer","getMyselfLocalIndex","getBankerPlayer","is_banker","initRoom","banker_mode","clear","room_status","forEach","account_status","banker_multiples","multiples","cards","card_type","combo_array","combo_point","getRoomCopyUrl","params","operation","session","data","roomId","type","url","href","ws","send","JSON","stringify","webCopyString","content","sys","isBrowser","input","el","document","createElement","value","setAttribute","style","contain","position","left","fontSize","selection","getSelection","originalRange","rangeCount","getRangeAt","body","appendChild","select","selectionStart","selectionEnd","length","success","execCommand","err","removeChild","removeAllRanges","addRange","webCaptureScreen","director","once","Director","EVENT_AFTER_DRAW","canvas","getElementById","base64","toDataURL","image","Image","src","append","require","AudioManager","audioManager","init","playBGM","WebSocketManager","webSocketManager","initHandlers","code","location","name","num","indexOf","paramsStr","substr","arr","split","i","substring","args"],"mappings":"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","file":"Global.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {},\r\n\r\n    onLoad: function() {\r\n        cc.log(\"Global onLoad....................\");\r\n        window.th = window.th || {};\r\n\r\n        this.initManager();\r\n        this.urlParse();\r\n\r\n        const { width, height } = this.node.getContentSize();\r\n        th.wsurl = \"ws://47.96.177.207:10000/api\"; //websocket连接地址\r\n        th.width = width; //宽度\r\n        th.height = height; //高度\r\n        th.myself = {\r\n            account_id: \"000000\",\r\n            nickname: \"游客\", //名字\r\n            headimgurl: \"\", //头像\r\n            account_ticket: 0, //房卡\r\n            phone: \"--------\",\r\n            isPlayer: false, //是不是玩家（不是玩家就是游客）， false=游客\r\n            needLookCount: 0 //只用为0才能点击摊牌  会在收到 ShowCard 设置\r\n        };\r\n        th.token = null;\r\n        th.sign = null;\r\n        th.gametype = null; //游戏类型 nn,zjh\r\n        th.room = {\r\n            room_id: null,\r\n            room_number: null,\r\n            players: [], //游戏人员列表\r\n            guests: [], //观战人员列表\r\n            max_count: 0, //总人数\r\n            copyurl: null //要copy的地地址\r\n        };\r\n        //座位坐标\r\n        th.seatxy = {\r\n            \"6\": [\r\n                [-305, -420],\r\n                [305, -100],\r\n                [305, 200],\r\n                [-100, 485],\r\n                [-305, 200],\r\n                [-305, -100]\r\n            ],\r\n            \"9\": [\r\n                [-305, -420],\r\n                [305, -200],\r\n                [305, 0],\r\n                [305, 200],\r\n                [305, 400],\r\n                [-305, 400],\r\n                [-305, 200],\r\n                [-305, 0],\r\n                [-305, -200]\r\n            ],\r\n            \"10\": [\r\n                [-305, -420],\r\n                [305, -220],\r\n                [305, -40],\r\n                [305, 140],\r\n                [305, 320],\r\n                [-100, 485],\r\n                [-305, 320],\r\n                [-305, 140],\r\n                [-305, -40],\r\n                [-305, -220]\r\n            ],\r\n            \"12\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [-100, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ],\r\n            \"13\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [305, 485],\r\n                [-305, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ]\r\n        };\r\n        th.getNiuIndex = function(cardType, comboPoint) {\r\n            cardType = Number(cardType);\r\n            let index = 0;\r\n            if (cardType == 1) {\r\n                index = 0;\r\n            } else if (cardType >= 4 && cardType <= 14) {\r\n                index = cardType + 6;\r\n            } else {\r\n                index = comboPoint;\r\n            }\r\n            return index;\r\n        };\r\n        th.getSeatXY = function() {\r\n            return th.seatxy[this.room.max_count.toString()];\r\n        };\r\n        th.getGuestById = function(account_id) {\r\n            return this.room.guests.find(\r\n                guest => guest.account_id == account_id\r\n            );\r\n        };\r\n        th.getPlayerById = function(account_id) {\r\n            return this.room.players.find(\r\n                player => player.account_id == account_id\r\n            );\r\n        };\r\n        th.getLocalIndex = function(index) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let total = Number(th.room.max_count);\r\n            let rindex =\r\n                (Number(index) - th.getMyselfSeatIndex() + total) % total;\r\n            return rindex;\r\n        };\r\n        th.getSeatIndexById = function(account_id) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getPlayerById(account_id);\r\n            return player.serial_num - 1;\r\n        };\r\n        th.getMyselfSeatIndex = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getPlayerById(th.myself.account_id);\r\n            return Number(player.serial_num) - 1;\r\n        };\r\n        th.getMyselfPlayer = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return null;\r\n            }\r\n            let player = this.getPlayerById(th.myself.account_id);\r\n            return player;\r\n        };\r\n        th.getMyselfLocalIndex = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = this.getMyselfPlayer();\r\n            return this.getLocalIndex(player.serial_num - 1);\r\n        };\r\n        th.getBankerPlayer = function() {\r\n            return this.room.players.find(player => player.is_banker == 1);\r\n        };\r\n        th.initRoom = function() {\r\n            if (th.room.banker_mode == 1) {\r\n                th.myself.needLookCount = 2;\r\n            } else if (th.room.banker_mode == 2) {\r\n                th.myself.needLookCount = 1;\r\n            }\r\n        };\r\n        th.clear = function() {\r\n            th.room.room_status = 1;\r\n            th.room.players.forEach(player => {\r\n                player.account_status = 1;\r\n                player.banker_multiples = \"\";\r\n                player.multiples = 0;\r\n                player.cards = [];\r\n                player.card_type = 0;\r\n                player.combo_array = [];\r\n                player.combo_point = 0;\r\n                player.is_banker = 0;\r\n            });\r\n            th.initRoom();\r\n        };\r\n        th.getRoomCopyUrl = function() {\r\n            //先把要COPY的房间URL请求回来\r\n            const params = {\r\n                operation: \"getCopyUrl\",\r\n                account_id: th.myself.account_id,\r\n                session: th.sign,\r\n                data: {\r\n                    roomId: th.room.room_number,\r\n                    type: th.gametype,\r\n                    url: th.href\r\n                }\r\n            };\r\n            cc.log(\"===>>>[getCopyUrl] Global:\", params);\r\n            th.ws.send(JSON.stringify(params));\r\n        };\r\n        th.webCopyString = function(content) {\r\n            //确保在浏览器中\r\n            if (cc.sys.isBrowser) {\r\n                const input = content + \"\";\r\n                const el = document.createElement(\"textarea\");\r\n                el.value = input;\r\n                el.setAttribute(\"readonly\", \"\");\r\n                el.style.contain = \"strict\";\r\n                el.style.position = \"absolute\";\r\n                el.style.left = \"-9999px\";\r\n                el.style.fontSize = \"12pt\"; // Prevent zooming on iOS\r\n\r\n                const selection = getSelection();\r\n                let originalRange = false;\r\n                if (selection.rangeCount > 0) {\r\n                    originalRange = selection.getRangeAt(0);\r\n                }\r\n                document.body.appendChild(el);\r\n                el.select();\r\n                el.selectionStart = 0;\r\n                el.selectionEnd = input.length;\r\n                let success = false;\r\n                try {\r\n                    success = document.execCommand(\"copy\");\r\n                } catch (err) {}\r\n\r\n                document.body.removeChild(el);\r\n                if (originalRange) {\r\n                    selection.removeAllRanges();\r\n                    selection.addRange(originalRange);\r\n                }\r\n                return success;\r\n            }\r\n            return false;\r\n        };\r\n        th.webCaptureScreen = function() {\r\n            if (cc.sys.isBrowser) {\r\n                cc.director.once(cc.Director.EVENT_AFTER_DRAW, () => {\r\n                    // 获取base64截图\r\n                    const canvas = document.getElementById(\"GameCanvas\");\r\n                    const base64 = canvas.toDataURL();\r\n\r\n                    /*\r\n                    // 1.用cc.Sprite组件显示截图\r\n                    const image = new Image();\r\n                    image.src = base64;\r\n                    image.onload = () => {\r\n                        const texture = new cc.Texture2D();\r\n                        texture.initWithElement(image);\r\n                        texture.handleLoadedTexture();\r\n                        const spriteFrame = new cc.SpriteFrame(texture);\r\n                        // this.img是cc.Sprite组件.\r\n                        this.img.spriteFrame = spriteFrame;\r\n                    }\r\n                    */\r\n\r\n                    // 2.用http的img显示截图（可以保存图片到本地）\r\n\r\n                    const image = new Image();\r\n                    image.src = base64;\r\n                    const body = document.createElement(\"body\");\r\n                    body.append(image);\r\n                    document.body = body;\r\n                    image.setAttribute(\"width\", \"100%\");\r\n                    image.setAttribute(\"height\", \"100%\");\r\n                });\r\n            }\r\n        };\r\n    },\r\n    initManager() {\r\n        th.ws = require(\"WebSocket\");\r\n\r\n        const AudioManager = require(\"AudioManager\");\r\n        th.audioManager = new AudioManager();\r\n        th.audioManager.init();\r\n\r\n        //播放背景音乐\r\n        th.audioManager.playBGM(\"background.mp3\");\r\n\r\n        const WebSocketManager = require(\"WebSocketManager\");\r\n        th.webSocketManager = new WebSocketManager();\r\n        th.webSocketManager.initHandlers();\r\n    },\r\n    urlParse() {\r\n        let params = { code: 123 };\r\n        if (window.location == null) {\r\n            return params;\r\n        }\r\n        let name, value;\r\n        let location = window.location.href; //取得整个地址栏\r\n        let num = location.indexOf(\"?\");\r\n        let paramsStr = location.substr(num + 1); //取得所有参数   stringvar.substr(start [, length ]\r\n        let arr = paramsStr.split(\"&\"); //各个参数放到数组里\r\n        for (let i = 0; i < arr.length; i++) {\r\n            num = arr[i].indexOf(\"=\");\r\n            if (num > 0) {\r\n                name = arr[i].substring(0, num);\r\n                value = arr[i].substr(num + 1);\r\n                params[name] = value;\r\n            }\r\n        }\r\n        cc.log(\"Params:\", params);\r\n        th.href = location.substr(0, location.indexOf(\"?\"));\r\n        th.args = params;\r\n    }\r\n});\r\n"]}