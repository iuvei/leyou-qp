{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Global.js"],"names":["cc","Class","extends","Component","properties","onLoad","log","window","th","initManager","urlParse","node","getContentSize","width","height","wsurl","myself","account_id","nickname","headimgurl","account_ticket","phone","isPlayer","token","sign","gametype","room","room_id","room_number","players","guests","max_count","seatxy","getSeatXY","toString","getLocalIndex","index","total","Number","rindex","getMyselfSeatIndex","getSeatIndexById","player","findIndex","serial_num","find","getMyselfPlayer","ws","require","AudioManager","audioManager","init","playBGM","WebSocketManager","webSocketManager","initHandlers","params","code","location","name","value","str","href","num","indexOf","substr","arr","split","i","length","substring","args"],"mappings":"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","file":"Global.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {},\r\n\r\n    onLoad: function() {\r\n        cc.log(\"Global onLoad....................\");\r\n        window.th = window.th || {};\r\n\r\n        this.initManager();\r\n        this.urlParse();\r\n\r\n        const { width, height } = this.node.getContentSize();\r\n        th.wsurl = \"ws://47.96.177.207:10000/api\"; //websocket连接地址\r\n        th.width = width; //宽度\r\n        th.height = height; //高度\r\n        th.myself = {\r\n            account_id: \"000000\",\r\n            nickname: \"游客\", //名字\r\n            headimgurl: \"\", //头像\r\n            account_ticket: 0, //房卡\r\n            phone: \"--------\",\r\n            isPlayer: false //是不是玩家（不是玩家就是游客）， false=游客\r\n        };\r\n        th.token = null;\r\n        th.sign = null;\r\n        th.gametype = null; //游戏类型 nn,zjh\r\n        th.room = {\r\n            room_id: null,\r\n            room_number: null,\r\n            players: [], //游戏人员列表\r\n            guests: [], //观战人员列表\r\n            max_count: 0 //总人数\r\n        };\r\n        //座位坐标\r\n        th.seatxy = {\r\n            \"6\": [\r\n                [-305, -420],\r\n                [305, -100],\r\n                [305, 200],\r\n                [-100, 485],\r\n                [-305, 200],\r\n                [-305, -100]\r\n            ],\r\n            \"9\": [\r\n                [-305, -420],\r\n                [305, -200],\r\n                [305, 0],\r\n                [305, 200],\r\n                [305, 400],\r\n                [-305, 400],\r\n                [-305, 200],\r\n                [-305, 0],\r\n                [-305, -200]\r\n            ],\r\n            \"10\": [\r\n                [-305, -420],\r\n                [305, -220],\r\n                [305, -40],\r\n                [305, 140],\r\n                [305, 320],\r\n                [-100, 485],\r\n                [-305, 320],\r\n                [-305, 140],\r\n                [-305, -40],\r\n                [-305, -220]\r\n            ],\r\n            \"12\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [-100, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ],\r\n            \"13\": [\r\n                [-305, -420],\r\n                [305, -260],\r\n                [305, -110],\r\n                [305, 40],\r\n                [305, 190],\r\n                [305, 340],\r\n                [305, 485],\r\n                [-305, 485],\r\n                [-305, 340],\r\n                [-305, 190],\r\n                [-305, 40],\r\n                [-305, -110],\r\n                [-305, -260]\r\n            ]\r\n        };\r\n        th.getSeatXY = function() {\r\n            return th.seatxy[this.room.max_count.toString()];\r\n        };\r\n\r\n        th.getLocalIndex = function(index) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let total = Number(th.room.max_count);\r\n            let rindex =\r\n                (Number(index) - th.getMyselfSeatIndex() + total) % total;\r\n            return rindex;\r\n        };\r\n        th.getSeatIndexById = function(account_id) {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = th.room.players.findIndex(\r\n                player => player.account_id == account_id\r\n            );\r\n            return player.serial_num - 1;\r\n        };\r\n        th.getMyselfSeatIndex = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return 0;\r\n            }\r\n            let player = th.room.players.find(\r\n                player => player.account_id == th.myself.account_id\r\n            );\r\n            return Number(player.serial_num) - 1;\r\n        };\r\n        th.getMyselfPlayer = function() {\r\n            if (!th.myself.isPlayer) {\r\n                return null;\r\n            }\r\n            let player = th.room.players.find(\r\n                player => player.account_id == th.myself.account_id\r\n            );\r\n            return player;\r\n        };\r\n    },\r\n    initManager() {\r\n        th.ws = require(\"WebSocket\");\r\n\r\n        const AudioManager = require(\"AudioManager\");\r\n        th.audioManager = new AudioManager();\r\n        th.audioManager.init();\r\n\r\n        //播放背景音乐\r\n        th.audioManager.playBGM(\"bg_hall.mp3\");\r\n\r\n        const WebSocketManager = require(\"WebSocketManager\");\r\n        th.webSocketManager = new WebSocketManager();\r\n        th.webSocketManager.initHandlers();\r\n    },\r\n    urlParse() {\r\n        var params = { code: 123 };\r\n        if (window.location == null) {\r\n            return params;\r\n        }\r\n        var name, value;\r\n        var str = window.location.href; //取得整个地址栏\r\n        var num = str.indexOf(\"?\");\r\n        str = str.substr(num + 1); //取得所有参数   stringvar.substr(start [, length ]\r\n        var arr = str.split(\"&\"); //各个参数放到数组里\r\n        for (var i = 0; i < arr.length; i++) {\r\n            num = arr[i].indexOf(\"=\");\r\n            if (num > 0) {\r\n                name = arr[i].substring(0, num);\r\n                value = arr[i].substr(num + 1);\r\n                params[name] = value;\r\n            }\r\n        }\r\n        cc.log(\"Params:\", params);\r\n        th.args = params;\r\n    }\r\n});\r\n"]}